// Generated Code Behind Header

CREATE ASSEMBLY [__codeBehind_stky1wji.v3v] FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C01030022621B590000000000000000E00002210B010B00001000000006000000000000CE2F0000002000000040000000000010002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000742F00005700000000400000E802000000000000000000000000000000000000006000000C0000003C2E00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000D40F0000002000000010000000020000000000000000000000000000200000602E72737263000000E8020000004000000004000000120000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001600000000000000000000000000004000004200000000000000000000000000000000B02F0000000000004800000002000500BC220000800B00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133002005E00000001000011280D00000A027B03000004330F027B020000041FFEFE0116FE012B0117000C082D0B02167D02000004020A2B1316730A0000060A06027B040000047D0400000406027B060000047D0500000406027B080000047D07000004060B2B00072A0000133001000B000000020000110228030000060A2B00062A00133003004C01000003000011027B020000040B07450200000007000000020000002B0738000100002B05382301000002157D020000040002027B050000046F0E00000A730F00000A7D0900000438DE0000000002027B0A000004281000000A7D0B000004027B070000047201000070027B0B0000047B1100000A6F0100002B00027B07000004720F000070027B0B0000047B1300000A6F0200002B00027B070000047223000070027B0B0000047B1400000A6F0300002B00027B07000004722B000070027B0B0000047B1500000A6F0300002B00027B070000047233000070027B0B0000047B1600000A6F0400002B00027B07000004723F000070027B0B0000047B1700000A6F0500002B0002027B070000046F1800000A7D0100000402177D02000004170A2B2E02157D020000040002027B090000046F1900000A250C7D0A0000040814FE0116FE010D093A01FFFFFF00160A2B00062A133001000B00000004000011027B010000040A2B00062A1A731A00000A7A0A002A000000133001000B00000005000011027B010000040A2B00062A6602281B00000A02037D0200000402280D00000A7D030000042A0000001330020023000000060000111FFE730A0000060A06027D0400000406037D0600000406047D08000004060B2B00072A1E02281C00000A2A0042534A4201000100000000000C00000076342E302E33303331390000000005006C000000D4030000237E0000400400009C05000023537472696E677300000000DC09000050000000235553002C0A00001000000023475549440000003C0A00004401000023426C6F6200000000000000020000015717A20B090A000000FA2533001600000100000019000000030000000B0000000A00000003000000050000001D0000000B0000000600000001000000020000000200000007000000020000000100000003000000010000000500000000000A000100000000000600620043000A009100760006009F0043000600A40043000600B80043000A00F700E4001B000B0100000A003A011A010A005A011A010600920143000A00C801C1010A00E201CF010A00EE0176000A00FC01CF010A000802C1010A00EA03E0030E0021040F040A00B004E4000A00C804C1010A00EF04E0030A001705C1010A003205C1010A005605E0030A006A05C1010A0080051A010000000001000000000001000100010010002800350005000100010003011000B30100002D00010003000100B2025D00010071036B0001007C036B000600BC0372000600D40076000600C60376000600DA007A000600D1037A000600F7037E0006000404820006002A048500842200000000C600C60013000100B322000000008618CE0020000300502000000000E101140242000300BC2000000000E1017C0254000300D42000000000E101A902590003002C2200000000E109BF0261000300432200000000E1012303200003004A2200000000E1014E0320000300502200000000E10991036E0003006722000000008618CE002A00030000000100D40000000200DA00000001007103030006000300310003000A000300390003003D003100CE0024004100CE002A004900CE0020005100CE0020000C006E024B0061006E0254007100A9025900140017036600710048032000790069032000710017036E009100CE0020009900D40492002100F604A7008100CE00AC0089000505B200890010056B0029001305B80089002005C40089002A05CD0089002E05CD0089003D05D40089004305E30029004B056100B9006105F200C100CE0020005900CE0020000900CE002000C900CE0020002E000B0011012E0013001A012E001B002301430023002F00600063002F006300EB002F00800063002F00C00063002F00E00063002F00200163002F00400163002F009600A200F600FD000201060103000100000035048900000089048E00020006000300020009000500030006000B00030008000D0003000A000F0003000C00110003000E00130003001000150003001200170034003B000480000000000000000000000000000000007801000001000000000000000000000001004300000000000400000000000000000000000A006D000000000001000000000000000000000000000F0400000000030002002500C0002500C8002500D0002500DB002500EA000000003C4D6F64756C653E005F5F636F6465426568696E645F73746B7931776A692E7633762E646C6C00547874457874726163746F7200546178694C6F636174696F6E73004D6963726F736F66742E416E616C79746963732E496E74657266616365730049457874726163746F72006D73636F726C69620053797374656D2E436F6C6C656374696F6E732E47656E657269630049456E756D657261626C6560310049526F770049556E737472756374757265645265616465720049557064617461626C65526F770045787472616374002E63746F7200696E707574006F7574707574726F770053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005F5F636F6465426568696E645F73746B7931776A692E7633760053716C55736572446566696E6564457874726163746F72417474726962757465003C457874726163743E645F5F300053797374656D004F626A6563740053797374656D2E436F6C6C656374696F6E730049456E756D657261626C650049456E756D657261746F7260310049456E756D657261746F720049446973706F7361626C650053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261626C653C4D6963726F736F66742E416E616C79746963732E496E74657266616365732E49526F773E2E476574456E756D657261746F7200476574456E756D657261746F720053797374656D2E436F6C6C656374696F6E732E49456E756D657261626C652E476574456E756D657261746F72004D6F76654E657874003C3E325F5F63757272656E740053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C4D6963726F736F66742E416E616C79746963732E496E74657266616365732E49526F773E2E6765745F43757272656E74006765745F43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E52657365740052657365740053797374656D2E49446973706F7361626C652E446973706F736500446973706F7365003C3E315F5F7374617465003C3E6C5F5F696E697469616C54687265616449640053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E6765745F43757272656E74003C3E345F5F74686973003C3E335F5F696E707574003C3E335F5F6F7574707574726F770053797374656D2E494F0053747265616D526561646572003C7265616465723E355F5F31003C6C696E653E355F5F320054617869446174615574696C6974696573005461786944617461003C646174613E355F5F330053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C4D6963726F736F66742E416E616C79746963732E496E74657266616365732E49526F773E2E43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E43757272656E7400446562756767657248696464656E41747472696275746500456E7669726F6E6D656E74006765745F43757272656E744D616E6167656454687265616449640053747265616D006765745F4261736553747265616D0046726F6D537472696E6700696400536574004461746554696D650074696D657374616D70006C6174006C6F6E004E756C6C61626C6560310073706565640073746179696E67004173526561644F6E6C79005465787452656164657200526561644C696E65004E6F74537570706F72746564457863657074696F6E00436F6D70696C657247656E6572617465644174747269627574650000000D5400610078006900490044000013540069006D0065007300740061006D00700000074C006100740000074C006F006E00000B53007000650065006400000F530074006100790069006E006700000099B51E209CAF7441B4C42863127217BD00089F877B68B06E0B5E08B77A5C561934E0890C200215120901120D121112150320000105200101111D042001010804010000000615120901120D0615123501120D08200015123501120D0820001512350113000420001239032000020306120D042000120D04200013000206080320001C0306120803061211030612150306124102060E03061245042800120D0328001C030000080B0703120C15123501120D020407011239042000125105200101125105000112450E07300102010E1E00030A010803061155040A01115502060D030A010D0606151159010D070A01151159010D06061511590108070A0115115901080320000E06070402080E02040701120D0307011C0A0702120C15120901120D0801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100000000000022621B5900000000020000001C010000582E00005810000052534453C3363EF39489DC40B6D2AA272F2D5B1601000000633A5C55736572735C414345525C417070446174615C4C6F63616C5C54656D705C446174614C616B6554656D705C5F5F636F6465426568696E645F73746B7931776A692E7633762E70646200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009C2F00000000000000000000BE2F0000002000000000000000000000000000000000000000000000B02F00000000000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000008C02000000000000000000008C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004EC010000010053007400720069006E006700460069006C00650049006E0066006F000000C801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000005C001E00010049006E007400650072006E0061006C004E0061006D00650000005F005F0063006F006400650042006500680069006E0064005F00730074006B007900310077006A0069002E007600330076002E0064006C006C0000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000064001E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005F005F0063006F006400650042006500680069006E0064005F00730074006B007900310077006A0069002E007600330076002E0064006C006C000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000D03F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;
REFERENCE ASSEMBLY [__codeBehind_stky1wji.v3v];

DEPLOY RESOURCE @"C:\Users\ACER\AppData\Local\Temp\DataLakeTemp\__codeBehind_stky1wji.v3v.pdb";
DEPLOY RESOURCE @"C:\Users\ACER\documents\visual studio 2015\Projects\TaxiLocations\TaxiDataUtilities\bin\Debug\TaxiDataUtilities.exe";
DEPLOY RESOURCE @"C:\Users\ACER\documents\visual studio 2015\Projects\TaxiLocations\TaxiDataUtilities\bin\Debug\TaxiDataUtilities.pdb";
// Generated Code Behind Header
@input =
    EXTRACT TaxiID int,
            Timestamp DateTime,
            Lat double,
            Lon double,
            Speed double?,
            Staying int?
    FROM "/taxi_february_speeds.txt"
    USING new TaxiLocations.TxtExtractor();

@speedPartition = SELECT *, (int)(Speed / 10) * 10 AS SpeedPartition FROM @input WHERE Speed.HasValue;

@min =
    SELECT SpeedPartition AS Speed, COUNT() AS PointCount
    FROM @speedPartition GROUP BY SpeedPartition;

@avgs =
    SELECT TaxiID, AVG(Speed) AS Average
    FROM @input WHERE Speed.HasValue && Speed >= 10 GROUP BY TaxiID;
    
@byHours =
    SELECT Timestamp.Hour AS Hour, COUNT() AS HourCount, AVG(Speed) AS AvgSpeed
    FROM @input WHERE Staying.HasValue && Staying < 4 GROUP BY Timestamp.Hour;

@byHoursStops =
    SELECT Timestamp.Hour AS Hour, COUNT() AS HourCount, AVG(Speed) AS AvgSpeed
    FROM @input WHERE Staying.HasValue && Staying >= 4 GROUP BY Timestamp.Hour;


OUTPUT @min
TO "/output.csv"
USING Outputters.Csv(outputHeader : true);

OUTPUT @avgs
TO "/outputSpeed.csv"
USING Outputters.Csv(outputHeader : true);

OUTPUT @byHours
TO "/outputHours.csv"
USING Outputters.Csv(outputHeader : true);

OUTPUT @byHoursStops
TO "/outputHoursStops.csv"
USING Outputters.Csv(outputHeader : true);// Generated Code Behind Footer
USE DATABASE [master];
USE SCHEMA [dbo];

DROP ASSEMBLY [__codeBehind_stky1wji.v3v];
// Generated Code Behind Footer
